<!-- Modal Dialog -->
@if (show()) {
<!-- Modal backdrop -->
<div class="fixed inset-0 z-40"></div>
<div class="fixed inset-0 z-50 flex items-center justify-center" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" (click)="closeDialog()">
  <div class="relative bg-background rounded-xl shadow-2xl max-w-md w-full mx-4" role="document" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="px-6 py-4 border-b border-border">
      <h5 class="text-lg font-semibold text-foreground" id="shareModalLabel">Share Search Results</h5>
      <button
        type="button"
        class="absolute top-4 right-4 text-muted-foreground hover:text-foreground w-6 h-6 flex items-center justify-center"
        (click)="closeDialog()"
        aria-label="Close"
      >
        <fa-icon [icon]="faClose" class="w-4 h-4"></fa-icon>
      </button>
    </div>

    <!-- Body -->
    <div class="px-6 py-4">
      @if (isGeneratingLink()) {
      <!-- Loading State -->
      <div class="text-center py-8">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
        <p class="text-muted-foreground">Generating share link...</p>
      </div>
      } @else if (error()) {
      <!-- Error State -->
      <div class="bg-destructive/10 border border-destructive/20 rounded-lg p-4 flex items-center" role="alert">
        <fa-icon [icon]="faExclamationTriangle" class="text-destructive mr-3"></fa-icon>
        <div class="flex-1 text-destructive">{{ error() }}</div>
        <button
          hlmBtn
          type="button"
          variant="outline"
          size="sm"
          (click)="retryGeneration()"
        >
          Retry
        </button>
      </div>
      } @else if (shareLink()) {
      <!-- Success State -->
      <p class="text-muted-foreground mb-4">
        Share this link to let others view your search results with the same filters:
      </p>
      
      <div class="flex rounded-lg border border-border overflow-hidden">
        <input
          type="text"
          class="flex-1 px-3 py-2 font-mono text-sm bg-muted border-0 focus:outline-none"
          [value]="shareLink()"
          readonly
          #linkInput
        />
        <button
          hlmBtn
          type="button"
          variant="default"
          size="sm"
          (click)="copyShareLink()"
          title="Copy to clipboard"
        >
          <fa-icon [icon]="linkCopied() ? faCheck : faCopy"></fa-icon>
        </button>
      </div>

      @if (linkCopied()) {
      <div class="bg-primary/10 border border-primary/20 rounded-lg p-3 mt-3 text-primary" role="alert">
        <fa-icon [icon]="faCheck" class="mr-2"></fa-icon>
        Link copied to clipboard!
      </div>
      }
      }
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 border-t border-border">
      <button
        hlmBtn
        type="button"
        variant="secondary"
        class="w-full"
        (click)="closeDialog()"
      >
        Close
      </button>
    </div>
  </div>
</div>
}
